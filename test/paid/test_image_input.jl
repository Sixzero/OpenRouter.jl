using OpenRouter
using OpenRouter: UserMessage, AIMessage
using Test

@testset "Image Input" begin
    # 200x60 PNG with "banana" written on it
    img_b64 = "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"
    msg = UserMessage(content="", image_data=["data:image/png;base64,$img_b64"])

    resp = aigen(msg, "anthropic:anthropic/claude-haiku-4.5"; sys_msg="Reply with only the word shown in the image.")
    @test resp isa AIMessage
    @test !isempty(resp.content)
    @test resp.tokens !== nothing
    println("âœ“ Image input: $(resp.content)")
end
